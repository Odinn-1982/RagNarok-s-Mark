<form>
  <div class="form-group">
    <label>Select which conditions should display as large overlays on tokens:</label>
    <p class="notes">Check the conditions you want to appear as large icons overlaid on tokens. Customize colors, glow, and animations per-condition.</p>
  </div>

  <div class="control-buttons">
    <button type="button" class="btn btn-enable-all">
      <i class="fas fa-check-square"></i> Enable All
    </button>
    <button type="button" class="btn btn-disable-all">
      <i class="fas fa-square"></i> Disable All
    </button>
    <button type="button" class="btn btn-reset-defaults">
      <i class="fas fa-redo"></i> Reset to Defaults
    </button>
  </div>

  <div class="condition-search-wrapper">
    <input type="text" class="condition-search" placeholder="Search conditions..." />
  </div>

  <div class="conditions-grid">
    {{#each conditions}}
    <div class="condition-row" data-condition-name="{{this.name}}">
      <div class="condition-header">
        <label class="checkbox">
          <input type="checkbox" name="condition-enabled-{{this.key}}" {{checked this.enabled}} />
          <span class="condition-name">{{this.name}}</span>
        </label>
        <div class="condition-icon-preview" title="Icon preview">
          <img class="condition-icon" src="{{this.icon}}" alt="{{this.name}}" />
        </div>
      </div>

      <div class="condition-settings" {{#unless this.enabled}}style="opacity: 0.5; pointer-events: none;"{{/unless}}>
        <div class="setting-row">
          <label for="color-{{this.key}}">Color:</label>
          <input type="color" id="color-{{this.key}}" name="condition-color-{{this.key}}" value="{{this.color}}" />
        </div>

        <div class="setting-row">
          <label for="glow-{{this.key}}">Glow Intensity:</label>
          <input type="range" id="glow-{{this.key}}" name="condition-glow-{{this.key}}" 
                 min="0.1" max="2.0" step="0.1" value="{{this.glow}}" />
          <span class="value-display">{{this.glow}}</span>
        </div>

        <div class="setting-row">
          <label for="animation-{{this.key}}">Animation:</label>
          <select id="animation-{{this.key}}" name="condition-animation-{{this.key}}">
            <option value="none" {{#if (eq this.animation 'none')}}selected{{/if}}>None</option>
            <option value="pulse" {{#if (eq this.animation 'pulse')}}selected{{/if}}>Pulse</option>
            <option value="glow" {{#if (eq this.animation 'glow')}}selected{{/if}}>Glow</option>
            <option value="bounce" {{#if (eq this.animation 'bounce')}}selected{{/if}}>Bounce</option>
            <option value="fade" {{#if (eq this.animation 'fade')}}selected{{/if}}>Fade</option>
          </select>
        </div>
      </div>
    </div>
    {{/each}}
  </div>

  <div class="form-group">
    <p class="notes">
      <i class="fas fa-info-circle"></i> 
      Conditions are detected by matching effect names (case-insensitive).
      Custom conditions from your world will appear automatically.
      Settings are saved in real-time.
    </p>
  </div>
</form>

<style>
  #ragnaroks-mark-config {
    font-size: 13px;
  }

  #ragnaroks-mark-config .control-buttons {
    display: flex;
    gap: 0.5rem;
    margin: 1rem 0;
    flex-wrap: wrap;
  }

  #ragnaroks-mark-config .btn {
    padding: 0.5rem 1rem;
    background: var(--color-bg-button);
    border: 1px solid var(--color-border-light);
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: background 0.2s;
  }

  #ragnaroks-mark-config .btn:hover {
    background: var(--color-bg-button-hover);
  }

  #ragnaroks-mark-config .condition-search-wrapper {
    margin: 0.5rem 0 1rem 0;
  }

  #ragnaroks-mark-config .condition-search {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid var(--color-border-light);
    border-radius: 4px;
    font-size: 13px;
  }

  #ragnaroks-mark-config .conditions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
    max-height: 600px;
    overflow-y: auto;
    padding: 0.5rem;
    border: 1px solid var(--color-border-light-tertiary);
    border-radius: 4px;
    background: var(--color-bg-secondary);
  }

  #ragnaroks-mark-config .condition-row {
    padding: 0.75rem;
    border: 1px solid var(--color-border-light);
    border-radius: 4px;
    background: var(--color-bg-primary);
  }

  #ragnaroks-mark-config .condition-header {
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--color-border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #ragnaroks-mark-config .condition-icon-preview {
    width: 40px;
    height: 40px;
    border: 1px solid var(--color-border-light);
    border-radius: 3px;
    padding: 2px;
    background: var(--color-bg-tertiary);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #ragnaroks-mark-config .condition-icon {
    width: 100%;
    height: 100%;
    object-fit: contain;
    cursor: pointer;
    transition: transform 0.2s;
  }

  #ragnaroks-mark-config .condition-icon:hover {
    transform: scale(1.1);
  }

  #ragnaroks-mark-config .ragnaroks-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: #000;
    color: #fff;
    padding: 0.5rem;
    border-radius: 3px;
    font-size: 10px;
    white-space: nowrap;
    z-index: 1000;
    margin-bottom: 5px;
  }

  #ragnaroks-mark-config .checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-weight: 600;
  }

  #ragnaroks-mark-config .checkbox input[type="checkbox"] {
    margin: 0;
    cursor: pointer;
  }

  #ragnaroks-mark-config .condition-settings {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    transition: opacity 0.2s;
  }

  #ragnaroks-mark-config .setting-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 12px;
  }

  #ragnaroks-mark-config .setting-row label {
    min-width: 100px;
    flex-shrink: 0;
  }

  #ragnaroks-mark-config .setting-row input[type="color"] {
    width: 50px;
    height: 28px;
    border: 1px solid var(--color-border-light);
    border-radius: 3px;
    cursor: pointer;
  }

  #ragnaroks-mark-config .setting-row input[type="range"] {
    flex: 1;
    min-width: 80px;
  }

  #ragnaroks-mark-config .value-display {
    min-width: 35px;
    text-align: right;
  }

  #ragnaroks-mark-config .setting-row select {
    flex: 1;
    padding: 0.25rem;
    border: 1px solid var(--color-border-light);
    border-radius: 3px;
    font-size: 12px;
  }

  #ragnaroks-mark-config .notes {
    font-size: 11px;
    color: var(--color-text-light-7);
    margin: 0.5rem 0;
  }
</style>
